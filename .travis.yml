sudo: false

notifications:
    email: false

# Only build pushes from the master branch. PRs are always built. The master
# build will also push the newly built docs to fatiando.org/dev
branches:
    only:
        - master
        - deploy

language: python

os:
    - linux

matrix:
    include:
        - python: '3.4'
          env: GMT=5.4.1
        - python: '3.5'
          env: GMT=5.4.1
        #- python: '3.6'
          #env: GMT=trunk
        - python: '3.6'
          env: GMT=5.4.1 COVERAGE=true

env:
    global:
        - COVERAGE=false
        - CONDA_PREFIX=/home/travis/miniconda3

before_install:
    # Get Miniconda from Continuum
    # Need to source the script to set the PATH variable in this environment
    # (not the scripts environment)
    - source ci/install-miniconda.sh
    # Create a conda env to install required libraries
    - conda update --yes conda
    #- conda create -n testenv --yes pip python=$PYTHON
    #- source activate testenv
    - conda install --yes python=$TRAVIS_PYTHON_VERSION pip -c conda-forge
    # Install dependencies
    - conda install --yes --file requirements.txt -c conda-forge
    - if [ "$COVERAGE" == "true" ]; then pip install coveralls==0.5; fi
    #- if [ "$GMT" == "trunk" ]; then conda install --yes --file requirements-gmt.txt -c conda-forge; fi
    # Install gmt from conda-forge or checkout and build trunk (place in conda
    # path)
    #- if [ "$GMT" == "trunk" ]; then ./ci/install-gmt-trunk.sh; else conda install --yes gmt=$GMT -c conda-forge; fi
    # Show installed pkg information for postmortem diagnostic
    - conda list

install:
    # Package and install
    - python setup.py bdist_wheel
    - pip install dist/*

script:
    # Run the test suite
    - if [ "$COVERAGE" == "true" ]; then make coverage; else make test; fi
    # Check code for PEP8 style
    - make pep8

after_success:
    - if [ "$COVERAGE" == "true" ]; then coveralls; fi

deploy:
    provider: pypi
    distributions: "sdist bdist_wheel"
    user: "Leonardo.Uieda"
    password:
        secure: "RwyxUm+8NNIKlJBglv3xHydTgvHFHO/NQbVSLNuUl4hfLgKjpKRqP6QgOhytFCrmJy1eCGtbzlOrhZZTZ0PsxDYwW5kVA0Z9BOJ6vwZ+4tOsc8Cwy/lgXQ8nTRYXXwgzc1JlL7JXHo992mdNCRaL8zYhJQXxlKxEyqjbvbeHFa+RxcfebpCbmSihkVyqNjQpAcVIrfOsx34WKc0j9Ua4oV2JNS/bj/531uUPbTL1OEhVcw1l6tnUUqD/oZ0aAJZ3U/PiyT2t9e9yHLwjs7F2LQakZPQa//weqoeTnzUJm7GX2pILRjhFQSkirmJNzf+SqyqRgSC2GZKM35sgVVHwPA5LM4EbGitx3dGHnadwTk7KG1anbfLBWC8rLvQFuvVc4hZJGrzfXIWELuasUm0Dhm+7d4iRw3c6+wifmrTWCkDUaV1YoTWIfeiLA74BJXexVTnGlzHO2LEIak7jy6iGPqTPJuiZudGlBX9X07B/uwwp4ggbP/BXmGggrKm/B83bSgre8oxmOiFedD7krobxRzeheJnoKTKHXJVXNvnZnyjFxEQ82tGpWLgu0AGGJu0zOTszqe3pRzaeUMIrxgqwAm7qWSeYXavo/jViHYEV/R1E2GmgNiA+hdRBDzbdJnp2XMX6igMiqAg8qgEQJ0+j4XQQvm44DkE0gATOQEi3koQ="
    on:
        #tags: true
        #branch: master
        branch: deploy
        python: "3.6"
    server: https://testpypi.python.org/pypi
